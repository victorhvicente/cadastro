<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <title>Cadastro de Usu치rios</title>
  <!-- Importa o Bootstrap para estiliza칞칚o -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="p-4">
  <div class="container-fluid">
    <h2 class="mb-4">游늶 Cadastro de Usu치rios</h2>

    <!-- Formul치rio de cadastro de usu치rios -->
    <form id="formUsuario">
      <!-- Campo oculto usado para armazenar o 칤ndice do usu치rio ao editar -->
      <input type="hidden" id="indice">

      <!-- Linha com campos Nome, Email e Telefone -->
      <div class="row mb-2">
        <div class="col-md-4">
          <input type="text" id="nome" class="form-control" placeholder="Nome">
        </div>
        <div class="col-md-4">
          <input type="email" id="email" class="form-control" placeholder="E-mail">
        </div>
        <div class="col-md-4">
          <input type="tel" id="telefone" class="form-control" placeholder="Telefone">
        </div>
      </div>

      <!-- Linha com campos CEP, bot칚o de busca e Rua -->
      <div class="row mb-2">
        <div class="col-md-3">
          <input type="text" id="cep" class="form-control" placeholder="CEP">
        </div>
        <div class="col-md-2">
          <!-- Bot칚o para buscar o CEP -->
          <button type="button" class="btn btn-secondary w-100" onclick="buscarCEP()">Buscar CEP</button>
        </div>
        <div class="col-md-7">
          <input type="text" id="rua" class="form-control" placeholder="Rua">
        </div>
      </div>

      <!-- Linha com campos N칰mero, Bairro, Cidade e Estado -->
      <div class="row mb-3">
        <div class="col-md-2">
          <input type="text" id="numero" class="form-control" placeholder="N칰mero">
        </div>
        <div class="col-md-4">
          <input type="text" id="bairro" class="form-control" placeholder="Bairro">
        </div>
        <div class="col-md-4">
          <input type="text" id="cidade" class="form-control" placeholder="Cidade">
        </div>
        <div class="col-md-2">
          <input type="text" id="estado" class="form-control" placeholder="Estado">
        </div>
      </div>

      <!-- Bot칫es de a칞칚o -->
      <button class="btn btn-success" type="button" onclick="salvarUsuario()">Salvar</button>
      <button class="btn btn-warning text-white" type="button" onclick="cancelar()">Cancelar</button>
    </form>

    <hr>

    <!-- Tabela com os usu치rios cadastrados -->
    <h4 class="mt-4">游논 Usu치rios Cadastrados</h4>
    <div class="table-responsive">
      <table class="table table-bordered mt-2">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Email</th>
            <th>Telefone</th>
            <th>CEP</th>
            <th>Rua</th>
            <th>n췈</th>
            <th>Bairro</th>
            <th>Cidade</th>
            <th>Estado</th>
            <th>A칞칫es</th>
          </tr>
        </thead>
        <tbody id="tabelaUsuarios"></tbody>
      </table>
    </div>
  </div>

  <script>
    // Recupera os usu치rios do localStorage, se houver
    let usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];

    // Fun칞칚o que salva um novo usu치rio ou atualiza um existente
    function salvarUsuario() {
      // Valida칞칚o dos campos obrigat칩rios
      if (document.getElementById("nome").value == "") {
        alert("O Campo nome 칠 obrigat칩rio");
        return;
      }
      if (document.getElementById("email").value == "") {
        alert("O Campo E-mail 칠 obrigat칩rio");
        return;
      }
      if (document.getElementById("telefone").value == "") {
        alert("O Campo Telefone 칠 obrigat칩rio");
        return;
      }

      // Cria um objeto com os dados do formul치rio
      let usuario = {
        nome: document.getElementById("nome").value,
        email: document.getElementById("email").value,
        telefone: document.getElementById("telefone").value,
        cep: document.getElementById("cep").value,
        rua: document.getElementById("rua").value,
        bairro: document.getElementById("bairro").value,
        cidade: document.getElementById("cidade").value,
        estado: document.getElementById("estado").value
      }

      // Verifica se 칠 um novo cadastro ou edi칞칚o
      let indice = document.getElementById("indice").value;
      if (indice == "") {
        // Novo usu치rio
        usuarios.push(usuario);
      } else {
        // Atualiza usu치rio existente
        usuarios[indice] = usuario;
      }

      // Salva no localStorage
      localStorage.setItem("usuarios", JSON.stringify(usuarios));

      // Atualiza a lista na tabela
      listarUsuarios();

      // Limpa o formul치rio
      cancelar();
    }

    // Busca endere칞o pelo CEP usando a API ViaCEP
    function buscarCEP() {
      let cep = document.getElementById("cep").value;

      // Valida se o CEP tem tamanho v치lido
      if (cep.length != 8 && cep.length != 9) {
        alert("CEP inv치lido. Digite novamente!");
        return;
      }

      // Faz a requisi칞칚o para a API
      fetch(`https://viacep.com.br/ws/${cep}/json/`)
        .then(res => res.json())
        .then(dados => {
          if (dados.erro) {
            alert("CEP n칚o encontrado");
            return;
          }

          // Preenche os campos com os dados do endere칞o
          document.getElementById("rua").value = dados.logradouro;
          document.getElementById("bairro").value = dados.bairro;
          document.getElementById("cidade").value = dados.localidade;
          document.getElementById("estado").value = dados.uf;

        }).catch(() => alert("Erro ao buscar CEP!")); // Trata erros de requisi칞칚o
    }

    // Lista todos os usu치rios na tabela
    function listarUsuarios() {
      let tbody = document.getElementById("tabelaUsuarios");
      tbody.innerHTML = ""; // Limpa o conte칰do da tabela

      // Cria uma linha na tabela para cada usu치rio
      for (let i = 0; i < usuarios.length; i++) {
        let tr = document.createElement("tr");
        let u = usuarios[i];
        tr.innerHTML = `
          <td>${u.nome}</td>
          <td>${u.email}</td>
          <td>${u.telefone}</td>
          <td>${u.cep}</td>
          <td>${u.rua}</td>
          <td>${u.numero || ""}</td>
          <td>${u.bairro}</td>
          <td>${u.cidade}</td>
          <td>${u.estado}</td>
          <td>
            <button class="btn btn-sm btn-warning text-white" onclick="editarUsuario(${i})">Editar</button>
            <button class="btn btn-sm btn-danger text-white" onclick="excluirUsuario(${i})">Excluir</button>
          </td>
        `;
        tbody.appendChild(tr);
      }
    }

    // Preenche o formul치rio com os dados do usu치rio selecionado para edi칞칚o
    function editarUsuario(i) {
      let u = usuarios[i];
      document.getElementById("nome").value = u.nome;
      document.getElementById("email").value = u.email;
      document.getElementById("telefone").value = u.telefone;
      document.getElementById("cep").value = u.cep;
      document.getElementById("rua").value = u.rua;
      document.getElementById("numero").value = u.numero || "";
      document.getElementById("bairro").value = u.bairro;
      document.getElementById("cidade").value = u.cidade;
      document.getElementById("estado").value = u.estado;
      document.getElementById("indice").value = i; // Guarda o 칤ndice para edi칞칚o
    }

    // Remove o usu치rio da lista
    function excluirUsuario(i) {
      // Confirma칞칚o
      if (confirm("Deseja realmente excluir este usu치rio?")) {
        usuarios.splice(i, 1); // Remove do array
        localStorage.setItem("usuarios", JSON.stringify(usuarios)); // Atualiza no localStorage
        listarUsuarios(); // Atualiza a tabela
      }

      cancelar(); // Limpa o formul치rio
    }

    // Limpa o formul치rio e o campo de 칤ndice
    function cancelar() {
      document.getElementById("formUsuario").reset();
      document.getElementById("indice").value = "";
    }

    // Executa ao carregar a p치gina para listar os usu치rios j치 cadastrados
    listarUsuarios();
  </script>
</body>

</html>
